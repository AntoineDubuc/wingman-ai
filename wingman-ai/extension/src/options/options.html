<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Wingman Settings</title>
  <link rel="stylesheet" href="options.css">
</head>
<body>
  <div class="options-page">
    <!-- Header with gradient background -->
    <header class="options-header">
      <div class="header-content">
        <img src="../icons/icon-48.png" alt="Wingman Logo" class="header-logo">
        <div>
          <h1 class="header-title">Wingman</h1>
          <p class="header-subtitle">Extension Settings</p>
        </div>
      </div>
      <button id="theme-toggle" class="theme-toggle" type="button" title="Toggle dark mode">
        <span class="theme-icon theme-icon-light"><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span>
        <span class="theme-icon theme-icon-dark"><svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg></span>
      </button>
    </header>

    <!-- Tab Navigation -->
    <nav class="tab-bar" role="tablist">
      <button class="tab active" id="tab-setup" data-tab="setup" role="tab" aria-selected="true" aria-controls="panel-setup">
        <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 2l-2 2m-7.61 7.61a5.5 5.5 0 1 1-7.778 7.778 5.5 5.5 0 0 1 7.777-7.777zm0 0L15.5 7.5m0 0l3 3L22 7l-3-3m-3.5 3.5L19 4"/></svg>
        <span class="tab-label">Setup</span>
      </button>
      <button class="tab" id="tab-calls" data-tab="calls" role="tab" aria-selected="false" aria-controls="panel-calls">
        <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="22"/></svg>
        <span class="tab-label">Call Settings</span>
      </button>
      <button class="tab" id="tab-personas" data-tab="personas" role="tab" aria-selected="false" aria-controls="panel-personas">
        <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
        <span class="tab-label">Personas</span>
      </button>
      <button class="tab" id="tab-conclave" data-tab="conclave" role="tab" aria-selected="false" aria-controls="panel-conclave">
        <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="5" r="3"/><circle cx="5" cy="19" r="3"/><circle cx="19" cy="19" r="3"/><line x1="12" y1="8" x2="5" y2="16"/><line x1="12" y1="8" x2="19" y2="16"/></svg>
        <span class="tab-label">Conclave</span>
      </button>
      <button class="tab" id="tab-langbuilder" data-tab="langbuilder" role="tab" aria-selected="false" aria-controls="panel-langbuilder">
        <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="5" cy="6" r="2"/><circle cx="19" cy="6" r="2"/><circle cx="12" cy="18" r="2"/><path d="M5 8v2a4 4 0 0 0 4 4h2"/><path d="M19 8v2a4 4 0 0 1-4 4h-2"/><line x1="12" y1="14" x2="12" y2="16"/></svg>
        <span class="tab-label">LangBuilder</span>
      </button>
      <button class="tab" id="tab-support" data-tab="support" role="tab" aria-selected="false" aria-controls="panel-support">
        <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        <span class="tab-label">Support & Feature Requests</span>
      </button>
      <div class="tab-indicator"></div>
    </nav>

    <!-- Main content area -->
    <main class="options-content">

      <!-- ==================== SETUP TAB ==================== -->
      <div class="tab-panel active" id="panel-setup" data-panel="setup" role="tabpanel" aria-labelledby="tab-setup">
        <!-- API Keys Card -->
        <div class="options-card">
          <h2 class="form-section-title">API Keys</h2>
          <p class="form-section-description">
            Enter your API keys to enable speech-to-text and AI responses.
            Your keys are stored locally and never sent to our servers.
          </p>

          <div class="api-key-section">
            <label for="deepgram-api-key" class="input-label">
              Deepgram API Key
              <a href="https://console.deepgram.com/" target="_blank" rel="noopener noreferrer" class="key-link">(Get one free)</a>
            </label>
            <div class="input-with-hint">
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="deepgram-api-key"
                  class="text-input api-key-input"
                  placeholder="Enter your Deepgram API key"
                  autocomplete="off"
                >
                <button type="button" class="toggle-visibility-btn" data-target="deepgram-api-key" title="Show/hide key">
                  <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
              </div>
              <p class="input-hint">Used for real-time speech-to-text transcription</p>
            </div>
          </div>

          <!-- AI Provider Toggle -->
          <div class="api-key-section">
            <label class="input-label">AI Provider</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="llm-provider" value="gemini" checked>
                <span class="radio-label">Gemini (direct)</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="llm-provider" value="openrouter">
                <span class="radio-label">OpenRouter</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="llm-provider" value="groq">
                <span class="radio-label">Groq</span>
              </label>
            </div>
            <p class="input-hint" style="margin-top: 6px;">Gemini uses your key directly. OpenRouter lets you choose from multiple models. Groq offers ultra-fast open-source AI.</p>
          </div>

          <!-- Gemini Key (visible when provider=gemini) -->
          <div id="gemini-key-section" class="api-key-section">
            <label for="gemini-api-key" class="input-label">
              Google Gemini API Key
              <a href="https://aistudio.google.com/apikey" target="_blank" rel="noopener noreferrer" class="key-link">(Get one free)</a>
            </label>
            <div class="input-with-hint">
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="gemini-api-key"
                  class="text-input api-key-input"
                  placeholder="Enter your Gemini API key"
                  autocomplete="off"
                >
                <button type="button" class="toggle-visibility-btn" data-target="gemini-api-key" title="Show/hide key">
                  <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
              </div>
              <p class="input-hint" id="gemini-hint">Used for AI-powered suggestions and responses</p>
            </div>
          </div>

          <!-- OpenRouter fields (visible when provider=openrouter) -->
          <div id="openrouter-section" style="display: none;">
            <div class="api-key-section">
              <label for="openrouter-api-key" class="input-label">
                OpenRouter API Key
                <a href="https://openrouter.ai/keys" target="_blank" rel="noopener noreferrer" class="key-link">(Get one)</a>
              </label>
              <div class="input-with-hint">
                <div class="password-input-wrapper">
                  <input
                    type="password"
                    id="openrouter-api-key"
                    class="text-input api-key-input"
                    placeholder="Enter your OpenRouter API key"
                    autocomplete="off"
                  >
                  <button type="button" class="toggle-visibility-btn" data-target="openrouter-api-key" title="Show/hide key">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                  </button>
                </div>
                <p class="input-hint">Used for AI-powered suggestions and responses via OpenRouter</p>
              </div>
            </div>

            <div class="api-key-section">
              <label for="openrouter-model-select" class="input-label">Model</label>
              <div class="input-with-hint">
                <select id="openrouter-model-select" class="select-input"></select>
                <p class="input-hint">Choose which AI model to use for suggestions and summaries</p>
              </div>
            </div>
          </div>

          <!-- Groq fields (visible when provider=groq) -->
          <div id="groq-section" style="display: none;">
            <div class="api-key-section">
              <label for="groq-api-key" class="input-label">
                Groq API Key
                <a href="https://console.groq.com/keys" target="_blank" rel="noopener noreferrer" class="key-link">(Get one free)</a>
              </label>
              <div class="input-with-hint">
                <div class="password-input-wrapper">
                  <input
                    type="password"
                    id="groq-api-key"
                    class="text-input api-key-input"
                    placeholder="Enter your Groq API key"
                    autocomplete="off"
                  >
                  <button type="button" class="toggle-visibility-btn" data-target="groq-api-key" title="Show/hide key">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                  </button>
                </div>
                <p class="input-hint">Ultra-fast inference on open-source models — free tier at console.groq.com</p>
              </div>
            </div>

            <div class="api-key-section">
              <label for="groq-model-select" class="input-label">Model</label>
              <div class="input-with-hint">
                <select id="groq-model-select" class="select-input"></select>
                <p class="input-hint">Choose which AI model to use for suggestions and summaries</p>
              </div>
            </div>
          </div>

          <!-- Hume AI (Emotion Detection) - Optional -->
          <div id="hume-section" class="api-key-section hume-optional-section">
            <div class="section-header-with-badge">
              <label class="input-label">Hume AI (Emotion Detection)</label>
              <span class="optional-badge">Optional</span>
            </div>
            <p class="input-hint" style="margin-bottom: 12px;">
              Show real-time customer emotion during calls. Requires a Hume AI account (~$0.06/min).
            </p>

            <div class="hume-fields">
              <div class="api-key-section" style="margin-bottom: 12px;">
                <label for="hume-api-key" class="input-label input-label-small">
                  API Key
                  <a href="https://app.hume.ai/keys" target="_blank" rel="noopener noreferrer" class="key-link">(Get keys)</a>
                </label>
                <div class="password-input-wrapper">
                  <input
                    type="password"
                    id="hume-api-key"
                    class="text-input api-key-input"
                    placeholder="Enter your Hume API key"
                    autocomplete="off"
                  >
                  <button type="button" class="toggle-visibility-btn" data-target="hume-api-key" title="Show/hide key">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                  </button>
                </div>
              </div>

              <div class="api-key-section" style="margin-bottom: 12px;">
                <label for="hume-secret-key" class="input-label input-label-small">Secret Key</label>
                <div class="password-input-wrapper">
                  <input
                    type="password"
                    id="hume-secret-key"
                    class="text-input api-key-input"
                    placeholder="Enter your Hume Secret key"
                    autocomplete="off"
                  >
                  <button type="button" class="toggle-visibility-btn" data-target="hume-secret-key" title="Show/hide key">
                    <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                  </button>
                </div>
              </div>

              <div class="hume-test-row">
                <button id="hume-test-btn" class="btn-secondary btn-small" type="button">Test Hume</button>
                <span id="hume-test-status" class="hume-test-status"></span>
              </div>
            </div>
          </div>

          <div class="button-row">
            <div class="api-status" id="api-status">
              <span class="status-dot status-unconfigured"></span>
              <span class="status-text">Keys not configured</span>
            </div>
            <div class="button-group">
              <button id="test-keys-btn" class="btn-secondary" type="button">
                Test Keys
              </button>
              <button id="save-keys-btn" class="btn-primary" type="button">
                Save Keys
              </button>
            </div>
          </div>
        </div>

        <!-- Google Drive Integration Card -->
        <div class="options-card">
          <h2 class="form-section-title">Google Drive Integration</h2>
          <p class="form-section-description">
            Automatically save meeting transcripts to your Google Drive after each session.
          </p>

          <div class="toggle-row">
            <div class="toggle-info">
              <label for="drive-autosave-toggle" class="toggle-label">Auto-save transcripts</label>
              <p class="toggle-description">
                When enabled, transcripts will be automatically saved to Google Drive when a session ends.
              </p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="drive-autosave-toggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="drive-connection-section">
            <div id="drive-not-connected" class="drive-status">
              <button id="drive-connect-btn" class="btn-primary" type="button">
                <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>
                Connect Google Account
              </button>
              <p class="drive-hint">Required to save transcripts to your Drive</p>
            </div>

            <div id="drive-connected" class="drive-status" style="display: none;">
              <div class="drive-account-info">
                <span class="drive-icon">&#10003;</span>
                <span id="drive-account-email">Connected</span>
              </div>
              <button id="drive-disconnect-btn" class="btn-secondary btn-small" type="button">
                Disconnect
              </button>
            </div>
          </div>

          <div class="drive-folder-section">
            <label for="drive-folder-name" class="input-label">Folder Name</label>
            <div class="input-with-hint">
              <input
                type="text"
                id="drive-folder-name"
                class="text-input"
                value="Wingman Transcripts"
                placeholder="Wingman Transcripts"
              >
              <p class="input-hint">Folder will be created in your Drive root if it doesn't exist</p>
            </div>
          </div>

          <div class="drive-format-section">
            <label class="input-label">Transcript Format</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="transcript-format" value="googledoc" checked>
                <span class="radio-label">Google Doc (formatted)</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="transcript-format" value="markdown">
                <span class="radio-label">Markdown (.md)</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="transcript-format" value="text">
                <span class="radio-label">Plain Text (.txt)</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="transcript-format" value="json">
                <span class="radio-label">JSON (.json)</span>
              </label>
            </div>
          </div>
        </div>

        <!-- Active Personas Card (Hydra) -->
        <div class="options-card">
          <h2 class="form-section-title">Active Personas for Calls</h2>
          <p class="form-section-description">
            Select which personas are active during your calls. Each active persona contributes suggestions from its own expertise and knowledge base.
          </p>

          <div id="active-personas-list" class="active-personas-list">
            <!-- Populated by JavaScript -->
          </div>

          <div id="active-personas-status" class="active-personas-status">
            0 of 0 active · Max 4 active personas.
          </div>

          <p class="input-hint" style="margin-top: 8px;">
            Each active persona evaluates transcripts independently. Set a Conclave Leader in the Conclave tab to guide post-call summaries.
          </p>
        </div>
      </div>

      <!-- ==================== CALL SETTINGS TAB ==================== -->
      <div class="tab-panel" id="panel-calls" data-panel="calls" role="tabpanel" aria-labelledby="tab-calls">
        <!-- Transcription Sensitivity Card -->
        <div class="options-card">
          <h2 class="form-section-title">Transcription Sensitivity</h2>
          <p class="form-section-description">
            Controls how long Wingman waits for a speaker to pause before finalizing a transcript segment.
            Higher values produce fewer, longer bubbles and fewer API calls.
          </p>

          <div class="slider-group">
            <div class="slider-header">
              <label for="endpointing-range" class="toggle-label">Pause threshold</label>
              <span id="endpointing-value" class="slider-value">0.7s</span>
            </div>
            <input type="range" id="endpointing-range" class="styled-slider" min="500" max="5000" step="100" value="700">
            <div class="slider-labels">
              <span>0.5s</span>
              <span>5s</span>
            </div>
            <p class="toggle-description">
              How long a speaker must pause before a new transcript bubble is created. Takes effect next session.
            </p>
          </div>
        </div>

        <!-- Suggestion Cooldown Card -->
        <div class="options-card">
          <h2 class="form-section-title">Suggestion Frequency</h2>
          <p class="form-section-description">
            Minimum time between AI suggestions. Higher values reduce API usage but may miss fast-paced conversation.
          </p>

          <div class="slider-group">
            <div class="slider-header">
              <label for="cooldown-range" class="toggle-label">Cooldown</label>
              <span id="cooldown-value" class="slider-value">15s</span>
            </div>
            <input type="range" id="cooldown-range" class="styled-slider" min="2000" max="30000" step="1000" value="15000">
            <div class="slider-labels">
              <span>2s</span>
              <span>30s</span>
            </div>
            <p class="toggle-description">
              After each suggestion, Wingman waits this long before considering the next one. Takes effect next session.
            </p>
          </div>
        </div>

        <!-- AI Tuning Card -->
        <div class="options-card">
          <h2 class="form-section-title">AI Prompt Tuning</h2>
          <p class="form-section-description">
            Adapts your persona prompts to work best with your selected AI model.
            Different models respond better to different prompt structures.
          </p>

          <div class="api-key-section">
            <label class="input-label">Tuning Mode</label>
            <div class="radio-group">
              <label class="radio-option">
                <input type="radio" name="prompt-tuning-mode" value="auto" checked>
                <span class="radio-label">Auto (recommended)</span>
              </label>
              <label class="radio-option">
                <input type="radio" name="prompt-tuning-mode" value="off">
                <span class="radio-label">Off</span>
              </label>
            </div>
            <p class="input-hint" style="margin-top: 6px;">Auto applies model-specific adjustments at runtime without modifying your saved prompts.</p>
          </div>
        </div>

        <!-- Speaker Filter Card -->
        <div class="options-card">
          <h2 class="form-section-title">Speaker Filter</h2>
          <p class="form-section-description">
            Control when Wingman provides suggestions based on who is speaking.
          </p>

          <div class="toggle-row">
            <div class="toggle-info">
              <label for="speaker-filter-toggle" class="toggle-label">Only respond to other speakers</label>
              <p class="toggle-description">
                When enabled, Wingman will only provide suggestions when customers or other participants speak,
                not when you're talking. Wingman will automatically detect you as the first speaker.
              </p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="speaker-filter-toggle">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Call Summary Card -->
        <div class="options-card">
          <h2 class="form-section-title">Call Summary</h2>
          <p class="form-section-description">
            Get an AI-generated summary with action items when your calls end.
          </p>

          <div class="toggle-row" id="summary-enabled-row">
            <div class="toggle-info">
              <label for="summary-enabled-toggle" class="toggle-label">Auto-generate call summary</label>
              <p class="toggle-description">
                Uses one additional AI API call per session.
              </p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="summary-enabled-toggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>

          <div class="toggle-row" id="summary-moments-row">
            <div class="toggle-info">
              <label for="summary-moments-toggle" class="toggle-label">Include key moments</label>
              <p class="toggle-description">
                Surfaces notable quotes and buying signals.
              </p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox" id="summary-moments-toggle" checked>
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>
      </div>

      <!-- ==================== PERSONAS TAB ==================== -->
      <div class="tab-panel" id="panel-personas" data-panel="personas" role="tabpanel" aria-labelledby="tab-personas">
        <div class="options-card">
          <div class="persona-header-row">
            <div>
              <h2 class="form-section-title">Personas</h2>
              <p class="form-section-description">
                Bundle a system prompt with specific Knowledge Base documents into switchable presets.
              </p>
            </div>
            <div class="button-group">
              <label class="btn-secondary btn-small persona-import-label">
                Import
                <input type="file" id="persona-import-input" accept=".json" hidden>
              </label>
              <button id="persona-new-btn" class="btn-primary btn-small" type="button">
                + New Persona
              </button>
            </div>
          </div>

          <!-- Persona list (populated by JS) -->
          <div id="persona-list" class="persona-list"></div>

          <!-- Empty state -->
          <div id="persona-empty" class="persona-empty">
            <p>Create your first persona to bundle a system prompt with specific Knowledge Base documents.</p>
          </div>
        </div>

        <!-- Persona editor (hidden until editing) -->
        <div id="persona-editor" class="options-card persona-editor" hidden>
          <h2 class="form-section-title" id="persona-editor-title">Edit Persona</h2>

          <!-- Name -->
          <div class="form-group">
            <label for="persona-name-input" class="input-label">Name</label>
            <input type="text" id="persona-name-input" class="text-input" placeholder="e.g. Cloud Security Demo" maxlength="60">
          </div>

          <!-- Color picker -->
          <div class="form-group">
            <label class="input-label">Color tag</label>
            <div id="persona-color-picker" class="persona-color-picker"></div>
          </div>

          <!-- System prompt -->
          <div class="form-group">
            <label for="persona-prompt-textarea" class="input-label">System Prompt</label>
            <div class="prompt-container">
              <textarea
                id="persona-prompt-textarea"
                class="prompt-textarea"
                placeholder="Enter your system prompt..."
                spellcheck="false"
              ></textarea>
              <div class="char-count" id="persona-char-count">
                <span id="persona-char-current">0</span> / <span>10,000</span> chars
              </div>
            </div>
          </div>

          <!-- Knowledge Base Section -->
          <div class="form-group">
            <label class="input-label">Knowledge Base</label>

            <!-- Drop Zone -->
            <div id="persona-kb-drop-zone" class="kb-drop-zone">
              <span class="kb-drop-icon"><svg width="32" height="32" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg></span>
              <span class="kb-drop-text">Drop files here or click to browse</span>
              <span class="kb-drop-hint">PDF, Markdown, or Text (max 10MB)</span>
              <input type="file" id="persona-kb-file-input" multiple accept=".pdf,.md,.txt,.markdown" hidden>
            </div>

            <!-- Progress (hidden by default) -->
            <div id="persona-kb-progress" class="kb-progress" hidden>
              <div class="kb-progress-bar"><div id="persona-kb-progress-fill" class="kb-progress-fill"></div></div>
              <span id="persona-kb-progress-text" class="kb-progress-text">Processing...</span>
            </div>

            <!-- Document List (populated by JS) -->
            <div id="persona-kb-doc-list" class="kb-doc-list"></div>

            <!-- Empty State -->
            <div id="persona-kb-empty" class="persona-kb-empty">No documents uploaded yet. Drag files above to add knowledge.</div>

            <!-- Stats -->
            <div id="persona-kb-stats" class="kb-stats"></div>

            <!-- Test Query (hidden until docs exist) -->
            <div id="persona-kb-test-section" class="kb-test-section" hidden>
              <label class="input-label">Test Knowledge Base</label>
              <div class="kb-test-row">
                <input type="text" id="persona-kb-test-input" class="text-input kb-test-input" placeholder="e.g. What security certifications do we have?">
                <button id="persona-kb-test-btn" class="btn-secondary btn-small" type="button">Test</button>
              </div>
              <div id="persona-kb-test-results" class="kb-test-results"></div>
            </div>
          </div>

          <!-- Action buttons -->
          <div class="button-row">
            <button id="persona-cancel-btn" class="btn-secondary" type="button">Cancel</button>
            <div class="button-group">
              <button id="persona-export-btn" class="btn-secondary" type="button">Export</button>
              <button id="persona-duplicate-btn" class="btn-secondary" type="button">Duplicate</button>
              <button id="persona-delete-btn" class="btn-secondary btn-danger" type="button">Delete</button>
              <button id="persona-save-btn" class="btn-primary" type="button">Save</button>
            </div>
          </div>
        </div>

        <!-- Import progress (hidden by default) -->
        <div id="persona-import-progress" class="options-card" hidden>
          <h2 class="form-section-title">Importing Persona...</h2>
          <div class="kb-progress">
            <div class="kb-progress-bar"><div id="persona-import-fill" class="kb-progress-fill"></div></div>
            <span id="persona-import-text" class="kb-progress-text">Processing...</span>
          </div>
        </div>
      </div>

      <!-- ==================== CONCLAVE TAB ==================== -->
      <div class="tab-panel" id="panel-conclave" data-panel="conclave" role="tabpanel" aria-labelledby="tab-conclave">
        <div class="options-card">
          <h2 class="form-section-title">Conclave Settings</h2>
          <p class="form-section-description">
            Configure how multiple personas work together during calls. The conclave leader guides post-call summaries.
          </p>

          <!-- Conclave Leader Picker -->
          <div class="api-key-section">
            <label for="conclave-leader-select" class="input-label">Conclave Leader</label>
            <div class="input-with-hint">
              <select id="conclave-leader-select" class="select-input">
                <option value="">Loading...</option>
              </select>
              <p class="input-hint">The conclave leader's expertise guides the post-call summary. Choose which persona should shape the summary's perspective.</p>
            </div>
          </div>
        </div>

        <!-- Presets Card -->
        <div class="options-card">
          <h2 class="form-section-title">Presets</h2>
          <p class="form-section-description">
            Save persona combinations for quick activation. Click a preset to instantly switch to that persona group.
          </p>

          <div id="conclave-presets-list" class="conclave-presets-list">
            <!-- Populated by JavaScript -->
          </div>

          <button type="button" id="conclave-add-preset" class="btn btn-secondary" style="margin-top: 12px;">
            + New Preset
          </button>
        </div>
      </div>

      <!-- ==================== LANGBUILDER TAB ==================== -->
      <div class="tab-panel" id="panel-langbuilder" data-panel="langbuilder" role="tabpanel" aria-labelledby="tab-langbuilder">
        <div class="options-card">
          <h2 class="form-section-title">LangBuilder Connection</h2>
          <p class="form-section-description">
            Connect to your LangBuilder instance to run AI workflows during meetings.
          </p>

          <div class="api-key-section">
            <label for="langbuilder-url" class="input-label">LangBuilder URL</label>
            <div class="input-with-hint">
              <input
                type="text"
                id="langbuilder-url"
                class="text-input"
                placeholder="https://langflow.company.com"
                autocomplete="off"
                style="max-width: 400px;"
              >
              <p class="input-hint">Base URL of your LangBuilder instance</p>
            </div>
          </div>

          <div class="api-key-section">
            <label for="langbuilder-api-key" class="input-label">API Key</label>
            <div class="input-with-hint">
              <div class="password-input-wrapper">
                <input
                  type="password"
                  id="langbuilder-api-key"
                  class="text-input api-key-input"
                  placeholder="Enter your LangBuilder API key"
                  autocomplete="off"
                >
                <button type="button" class="toggle-visibility-btn" data-target="langbuilder-api-key" title="Show/hide key">
                  <svg width="18" height="18" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                </button>
              </div>
              <p class="input-hint">x-api-key token from your LangBuilder settings</p>
            </div>
          </div>

          <div class="button-row">
            <div class="api-status" id="langbuilder-status">
              <span class="status-dot status-unconfigured"></span>
              <span class="status-text">Not configured</span>
            </div>
            <div class="button-group">
              <button id="langbuilder-test-btn" class="btn-secondary" type="button">
                Test Connection
              </button>
              <button id="langbuilder-save-btn" class="btn-primary" type="button">
                Save
              </button>
            </div>
          </div>
        </div>

        <!-- Flow preview (hidden until configured) -->
        <div class="options-card" id="langbuilder-flows-card" style="display: none;">
          <h2 class="form-section-title">Available Flows</h2>
          <p class="form-section-description">
            Flows from your LangBuilder instance. Select a flow during meetings from the overlay panel.
          </p>
          <select id="langbuilder-flow-preview" class="select-input">
            <option disabled selected>No flows loaded</option>
          </select>
        </div>
      </div>

      <!-- ==================== SUPPORT & FEATURE REQUESTS TAB ==================== -->
      <div class="tab-panel" id="panel-support" data-panel="support" role="tabpanel" aria-labelledby="tab-support">
        <!-- Support Card -->
        <div class="options-card support-card" style="text-align: center; margin-bottom: 20px;">
          <div class="support-hero">
            <svg width="48" height="48" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
            <h2 class="form-section-title">Support Wingman</h2>
            <p class="form-section-description">
              Enjoying Wingman? Your support helps fund new features and improvements.
            </p>
          </div>
          <a href="https://buymeacoffee.com/antoinedubuc" target="_blank" rel="noopener noreferrer" class="btn-primary support-coffee-btn">
            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
            Buy Me a Coffee
          </a>
        </div>

        <!-- Tutorials Card -->
        <div class="options-card support-card" style="text-align: center; margin-bottom: 20px;">
          <div class="support-hero">
            <svg width="48" height="48" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/><line x1="12" y1="6" x2="12" y2="10"/><line x1="12" y1="14" x2="12.01" y2="14"/></svg>
            <h2 class="form-section-title">Tutorials &amp; Guides</h2>
            <p class="form-section-description">
              Learn how to get the most out of Wingman with step-by-step tutorials.
            </p>
          </div>
          <a href="#" id="open-tutorials-support" class="btn-primary support-coffee-btn" style="background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);">
            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
            View Tutorials
          </a>
        </div>

        <!-- Feature Requests Card -->
        <div class="options-card" style="text-align: center;">
          <div class="support-hero">
            <svg width="48" height="48" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
            <h2 class="form-section-title">Feature Requests & Bug Reports</h2>
            <p class="form-section-description">
              Have an idea for a new feature? Found a bug? We'd love to hear from you.
            </p>
          </div>
          <a href="https://github.com/AntoineDubuc/Wingman-AI/issues/new" target="_blank" rel="noopener noreferrer" class="btn-primary support-coffee-btn">
            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg>
            Submit on GitHub
          </a>
        </div>

        <!-- LangBuilder Card -->
        <div class="options-card" style="text-align: center; margin-top: 20px;">
          <div class="support-hero">
            <img src="../assets/langbuilder-logo.png" alt="LangBuilder" width="64" height="64" style="margin-bottom: 8px;">
            <h2 class="form-section-title">Built with LangBuilder</h2>
            <p class="form-section-description">
              Wingman's AI workflows are powered by <strong>LangBuilder</strong> — CloudGeometry's open-source AI agent platform. Build visual AI workflows with no vendor lock-in, supporting GPT, Claude, Gemini, and more.
            </p>
          </div>
          <a href="https://www.cloudgeometry.com/solutions/langbuilder" target="_blank" rel="noopener noreferrer" class="btn-primary support-coffee-btn" style="background: linear-gradient(135deg, #e67e22 0%, #d35400 100%);">
            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
            Learn More
          </a>
        </div>

        <!-- Connect Card -->
        <div class="options-card" style="text-align: center; margin-top: 20px;">
          <div class="support-hero">
            <img src="../assets/linkedin-profile.png" alt="Antoine Dubuc" style="max-width: 100%; height: auto; border-radius: 12px; margin-bottom: 12px; border: 3px solid #e67e22;">
            <h2 class="form-section-title">Connect with the Creator</h2>
            <p class="form-section-description">
              Hi, I'm Antoine Dubuc — Senior Technical Product Manager for LangBuilder at CloudGeometry.
            </p>
            <p class="form-section-description" style="margin-top: 8px;">
              I'd love to hear how you're using Wingman! Also happy to chat if you're curious about LangBuilder.
            </p>
          </div>
          <a href="https://www.linkedin.com/in/antoinedubuc/" target="_blank" rel="noopener noreferrer" class="btn-primary support-coffee-btn" style="background: linear-gradient(135deg, #0077b5 0%, #005885 100%);">
            <svg width="20" height="20" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
            Connect on LinkedIn
          </a>
        </div>
      </div>

    </main>

    <!-- Footer with version -->
    <footer class="options-footer">
      <span class="version">v1.0.0</span>
    </footer>

    <!-- Toast notification component -->
    <div id="toast" class="toast" role="alert" aria-live="polite">
      <span class="toast-icon" id="toast-icon"></span>
      <span class="toast-message" id="toast-message"></span>
    </div>

    <!-- Confirmation modal component -->
    <div id="modal-overlay" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal">
        <h3 class="modal-title" id="modal-title">Reset to Default?</h3>
        <p class="modal-body" id="modal-body">
          This will replace your custom prompt with the original Wingman prompt.
          This action cannot be undone.
        </p>
        <div class="modal-actions">
          <button id="modal-cancel" class="btn-modal-cancel" type="button">
            Cancel
          </button>
          <button id="modal-confirm" class="btn-modal-confirm" type="button">
            Reset
          </button>
        </div>
      </div>
    </div>
  </div>

  <script src="options.ts" type="module"></script>
</body>
</html>
